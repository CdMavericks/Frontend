<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ClassSight Login</title>

  <!-- Link to your shared stylesheet -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>

<body class="page-body">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-inner">
      <div class="nav-left">
        <svg class="nav-logo" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
          </path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
          </path>
        </svg>
        <span class="nav-title">ClassSight</span>
      </div>

      <div class="nav-links">
        <a href="#" class="nav-link">About</a>
        <a href="#" class="nav-link">Contact</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-section">
    <div class="login-container">
      <!-- Login view -->
      <div id="login-view">
        <div class="logo-box">
          <svg class="logo-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z">
            </path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
            </path>
          </svg>
        </div>

        <h1 class="login-title">ClassSight Login</h1>
        <p class="login-subtext">
          Please sign in with your official nmamit.in Google account.
        </p>

        <button id="googleLoginBtn" class="google-login-btn">
          <svg class="google-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
            <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8
                  c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12
                  c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657
                  C34.046,6.053,29.268,4,24,4
                  C12.955,4,4,12.955,4,24
                  c0,11.045,8.955,20,20,20
                  c11.045,0,20-8.955,20-20
                  C44,22.659,43.862,21.35,43.611,20.083z"></path>
          </svg>
          Sign in with Google
        </button>

        <p id="error-message" class="error-message"></p>
      </div>

      <!-- Logged-in view -->
      <div id="logged-in-view" class="hidden">
        <h1 class="login-success-title">Success!</h1>
        <div class="user-photo-wrap">
          <img id="user-photo" class="user-photo" />
        </div>
        <p class="user-welcome">Welcome,</p>
        <p id="user-name" class="user-name"></p>
        <p id="user-email" class="user-email"></p>

        <a href="upload.html" class="proceed-btn">
          Proceed to Enroll Photos
        </a>

        <button id="logout-btn" class="logout-btn">Sign Out</button>
      </div>
    </div>
  </main>

  <!-- Firebase Auth -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signInWithRedirect,
      signOut,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBujiz5R1qEHcLvlMp9fQIViIMuWs3gRZk",
      authDomain: "cam-attendance-a4881.firebaseapp.com",
      projectId: "cam-attendance-a4881",
      storageBucket: "cam-attendance-a4881.appspot.com",
      messagingSenderId: "344849505667",
      appId: "1:344849505667:web:9a8ddb0a009f458fca2ab6",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();
    provider.setCustomParameters({ hd: "nmamit.in" });

    const loginBtn = document.getElementById("googleLoginBtn");
    const logoutBtn = document.getElementById("logout-btn");
    const loginView = document.getElementById("login-view");
    const loggedInView = document.getElementById("logged-in-view");
    const userName = document.getElementById("user-name");
    const userEmail = document.getElementById("user-email");
    const userPhoto = document.getElementById("user-photo");
    const errorMsg = document.getElementById("error-message");

    loginBtn.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        console.error("Sign-in error:", err);
        if (err.code === "auth/popup-blocked") {
          await signInWithRedirect(auth, provider);
        } else {
          errorMsg.textContent = "Allow popups and try again.";
        }
      }
    });

    logoutBtn.addEventListener("click", () => signOut(auth));

    // Inside the <script type="module"> block

    onAuthStateChanged(auth, (user) => {
      if (user && user.email.endsWith("@nmamit.in")) {
        // --- ADD THESE LINES TO STORE DATA ---
        localStorage.setItem('currentUserUid', user.uid);
        localStorage.setItem('currentUserEmail', user.email);
        // -------------------------------------

        userName.textContent = user.displayName;
        userEmail.textContent = user.email;
        userPhoto.src = user.photoURL;
        loginView.classList.add("hidden");
        loggedInView.classList.remove("hidden");
      } else {
        // --- ADD THESE LINES TO CLEAR DATA ON LOGOUT ---
        localStorage.removeItem('currentUserUid');
        localStorage.removeItem('currentUserEmail');
        // -----------------------------------------------
        loggedInView.classList.add("hidden");
        loginView.classList.remove("hidden");
      }
    });
  </script>
</body>

</html>